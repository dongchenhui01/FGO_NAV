# LSTM_TimeFGO_nav - æ°´ä¸‹å¯¼èˆªæ—¶é—´ä¸­å¿ƒå› å­å›¾ä¼˜åŒ–ç³»ç»Ÿ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**LSTM_TimeFGO_nav** æ˜¯ä¸€ä¸ªåŸºäºæ—¶é—´ä¸­å¿ƒå› å­å›¾ä¼˜åŒ–çš„é«˜ç²¾åº¦æ°´ä¸‹å¯¼èˆªç³»ç»Ÿï¼Œç»“åˆäº†LSTMç¥ç»ç½‘ç»œå’Œè¿ç»­æ—¶é—´å› å­å›¾ä¼˜åŒ–æŠ€æœ¯ï¼Œç”¨äºå®ç°å®æ—¶ã€é²æ£’çš„æ°´ä¸‹è½½ä½“å®šä½ä¸å¯¼èˆªã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§
- **æ—¶é—´ä¸­å¿ƒå› å­å›¾ä¼˜åŒ–**: åŸºäºè¿ç»­æ—¶é—´è½¨è¿¹è¡¨ç¤ºçš„é«˜ç²¾åº¦å®šä½
- **å¤šä¼ æ„Ÿå™¨èåˆ**: IMUã€DVLã€GPSã€ç£åŠ›è®¡æ•°æ®èåˆ
- **LSTMç¥ç»ç½‘ç»œ**: å­¦ä¹ ä¼ æ„Ÿå™¨è¿åŠ¨ç‰¹æ€§ï¼Œæé«˜é¢„æµ‹ç²¾åº¦
- **å®æ—¶å¤„ç†**: < 10msä¼˜åŒ–æ±‚è§£æ—¶é—´ï¼Œæ”¯æŒå®æ—¶å¯¼èˆª
- **é²æ£’æ€§**: æ”¯æŒä¼ æ„Ÿå™¨æ•…éšœå’Œå¼‚å¸¸å€¼å¤„ç†

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æ•´ä½“ç»“æ„
```
LSTM_TimeFGO_nav/
â”œâ”€â”€ underwater_nav_ws/           # ROS2å·¥ä½œç©ºé—´ (æ ¸å¿ƒå¯¼èˆªç³»ç»Ÿ)
â”œâ”€â”€ lstm_dvl_training/           # LSTMç¥ç»ç½‘ç»œè®­ç»ƒæ¨¡å—
â”œâ”€â”€ auv_simulation_env/          # AUVä»¿çœŸéªŒè¯ç¯å¢ƒ
â”œâ”€â”€ gtsam_project/               # GTSAMç›¸å…³å·¥å…·å’ŒAPI
â”œâ”€â”€ underwater_nav_fgo/          # é…ç½®ã€æ•°æ®å’Œå¯åŠ¨æ–‡ä»¶
â”œâ”€â”€ start_navigation.sh          # ä¸€é”®å¯åŠ¨è„šæœ¬
â””â”€â”€ docs/                        # æ–‡æ¡£å’Œå®éªŒç»“æœ
```

### æ ¸å¿ƒæ¨¡å—è¯¦è§£

#### 1. æ°´ä¸‹å¯¼èˆªç³»ç»Ÿ (`underwater_nav_ws/`)
**ä¸»è¦åŠŸèƒ½**: å®ç°æ—¶é—´ä¸­å¿ƒå› å­å›¾ä¼˜åŒ–çš„æ ¸å¿ƒå¯¼èˆªç®—æ³•

**æ ¸å¿ƒç»„ä»¶**:
- **æ•°æ®é¢„å¤„ç†æ¨¡å—** (`data_preprocessing/`)
  - CSVæ•°æ®æ’­æ”¾å™¨ï¼Œæ”¯æŒå¤šç§ä¼ æ„Ÿå™¨æ•°æ®æ ¼å¼
  - æ—¶é—´æˆ³åŒæ­¥å’Œé«˜ç²¾åº¦æ—¶é—´å¤„ç†
  - æ•°æ®è´¨é‡æ£€æŸ¥å’Œæœ‰æ•ˆæ€§éªŒè¯

- **å› å­å›¾ä¼˜åŒ–å™¨** (`factor_graph_optimizer/`)
  - æ—¶é—´ä¸­å¿ƒå› å­å›¾æ„å»ºå’Œä¼˜åŒ–
  - ISAM2å¢é‡ä¼˜åŒ–ç®—æ³•å®ç°
  - å¤šä¼ æ„Ÿå™¨å› å­ï¼ˆIMUã€DVLã€GPSã€ç£åŠ›è®¡ï¼‰
  - è¿ç»­æ—¶é—´çº¦æŸå’Œè½¨è¿¹å¹³æ»‘

- **å¯è§†åŒ–æ¨¡å—** (`visualization/`)
  - å®æ—¶è½¨è¿¹æ˜¾ç¤ºå’Œä¼ æ„Ÿå™¨æ•°æ®å¯è§†åŒ–
  - RVizé…ç½®å’Œè‡ªå®šä¹‰æ˜¾ç¤ºæ’ä»¶

**æŠ€æœ¯ç‰¹ç‚¹**:
- ä½¿ç”¨GTSAM 4.1+ä½œä¸ºåº•å±‚ä¼˜åŒ–å¼•æ“
- æ”¯æŒè¿ç»­æ—¶é—´è½¨è¿¹è¡¨ç¤º
- å®ç°æ»‘åŠ¨çª—å£è¾¹ç¼˜åŒ–ç­–ç•¥
- æä¾›é²æ£’æ ¸å‡½æ•°å¤„ç†å¼‚å¸¸å€¼

#### 2. LSTMç¥ç»ç½‘ç»œè®­ç»ƒæ¨¡å— (`lstm_dvl_training/`)
**ä¸»è¦åŠŸèƒ½**: è®­ç»ƒLSTMæ¨¡å‹å­¦ä¹ ä¼ æ„Ÿå™¨è¿åŠ¨ç‰¹æ€§ï¼Œæé«˜é¢„æµ‹ç²¾åº¦

**æ ¸å¿ƒç‰¹æ€§**:
- **3å±‚LSTMæ¶æ„**: [128, 64, 32]éšè—å•å…ƒé…ç½®
- **æ—¶é—´åºåˆ—é¢„æµ‹**: ä»å†å²çŠ¶æ€åºåˆ—é¢„æµ‹ä¸‹ä¸€æ—¶åˆ»ä½ç½®
- **å¤šä¼ æ„Ÿå™¨è¾“å…¥**: IMUã€DVLã€GPSæ•°æ®èåˆè®­ç»ƒ
- **è‡ªé€‚åº”å­¦ä¹ **: æ”¯æŒæ¢¯åº¦è£å‰ªå’Œå­¦ä¹ ç‡è°ƒæ•´

**è®­ç»ƒæµç¨‹**:
```python
# å¿«é€Ÿå¼€å§‹
python quick_start.py

# åˆ†æ­¥æ‰§è¡Œ
python data_processor.py    # æ•°æ®é¢„å¤„ç†
python train_lstm.py       # æ¨¡å‹è®­ç»ƒ
python evaluate.py         # æ¨¡å‹è¯„ä¼°
```

#### 3. AUVä»¿çœŸéªŒè¯ç¯å¢ƒ (`auv_simulation_env/`)
**ä¸»è¦åŠŸèƒ½**: æä¾›å®Œæ•´çš„ä»¿çœŸç¯å¢ƒéªŒè¯ç®—æ³•ç²¾åº¦å’Œæ€§èƒ½

**æŠ€æœ¯æ¶æ„**:
- **ArduSub SITL**: è½¯ä»¶åœ¨ç¯ä»¿çœŸï¼Œæ¨¡æ‹Ÿé£æ§ç¡¬ä»¶
- **Gazebo**: 3Dç‰©ç†ä»¿çœŸå¼•æ“ï¼Œæä¾›Ground Truth
- **ROS 2**: é€šä¿¡æ¡†æ¶ï¼Œè¿æ¥å„ç»„ä»¶
- **MAVROS**: ROSä¸ArduPilotçš„æ¡¥æ¢

**éªŒè¯èƒ½åŠ›**:
- ç®—æ³•ç²¾åº¦éªŒè¯ï¼ˆå¯¹æ¯”Ground Truthï¼‰
- æ€§èƒ½æµ‹è¯•ï¼ˆè®¡ç®—æ•ˆç‡ã€å®æ—¶æ€§ï¼‰
- é—­ç¯ä»¿çœŸæµ‹è¯•
- ä¼ æ„Ÿå™¨æ•…éšœæ¨¡æ‹Ÿ

## ğŸ”§ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶
- **ROS2 Galactic**: æœºå™¨äººæ“ä½œç³»ç»Ÿ
- **GTSAM 4.1+**: å‡ ä½•SLAMå·¥å…·ç®±
- **Eigen3**: çº¿æ€§ä»£æ•°åº“
- **Boost**: C++æ‰©å±•åº“

### ç¼–ç¨‹è¯­è¨€
- **C++17**: ä¸»è¦å¼€å‘è¯­è¨€ï¼ˆå¯¼èˆªç®—æ³•ï¼‰
- **Python 3.8**: æ•°æ®åˆ†æå’Œæœºå™¨å­¦ä¹ 
- **CMake**: æ„å»ºç³»ç»Ÿ

### ç®—æ³•æŠ€æœ¯
- **æ—¶é—´ä¸­å¿ƒå› å­å›¾ä¼˜åŒ–**: è¿ç»­æ—¶é—´è½¨è¿¹è¡¨ç¤º
- **é«˜æ–¯è¿‡ç¨‹å›å½’**: æ—¶é—´æ’å€¼å’Œå¹³æ»‘
- **ISAM2å¢é‡ä¼˜åŒ–**: å®æ—¶å› å­å›¾æ±‚è§£
- **LSTMç¥ç»ç½‘ç»œ**: æ·±åº¦å­¦ä¹ é¢„æµ‹
- **å¤šä¼ æ„Ÿå™¨èåˆ**: IMU/DVL/GPS/ç£åŠ›è®¡

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04 LTS
- **ROS2**: Galacticç‰ˆæœ¬
- **GTSAM**: 4.1æˆ–æ›´é«˜ç‰ˆæœ¬
- **Python**: 3.8+
- **ç¡¬ä»¶**: è‡³å°‘8GB RAMï¼Œæ¨è16GB

### ä¸€é”®å¯åŠ¨
```bash
# å…‹éš†é¡¹ç›®
git clone <repository_url>
cd LSTM_TimeFGO_nav

# ä¸€é”®å¯åŠ¨å®Œæ•´ç³»ç»Ÿ
./start_navigation.sh
```

### æ‰‹åŠ¨å¯åŠ¨
```bash
# 1. ç¼–è¯‘é¡¹ç›®
cd underwater_nav_ws
source /opt/ros/galactic/setup.bash
colcon build --parallel-workers 1

# 2. è®¾ç½®ç¯å¢ƒ
source install/setup.bash

# 3. å¯åŠ¨å„ä¸ªèŠ‚ç‚¹
ros2 run tf2_ros static_transform_publisher 0 0 0 0 0 0 map base_link
ros2 run data_preprocessing csv_player_node --ros-args -p data_file:=../data/sensor_fusion_log.csv
ros2 run factor_graph_optimizer time_centric_navigation_node
ros2 run factor_graph_optimizer visualization_node
rviz2 -d ../rviz/underwater_nav_2d.rviz
```

## ğŸ“Š ç³»ç»Ÿç‰¹æ€§

### å› å­å›¾ç»“æ„
```
å› å­å›¾èŠ‚ç‚¹:
â”œâ”€â”€ X(i): ä½å§¿èŠ‚ç‚¹ (Pose3)
â”œâ”€â”€ V(i): é€Ÿåº¦èŠ‚ç‚¹ (Vector3)  
â””â”€â”€ B(i): IMUåå·®èŠ‚ç‚¹ (imuBias::ConstantBias)

å› å­ç±»å‹:
â”œâ”€â”€ å…ˆéªŒå› å­ (Prior Factors)
â”œâ”€â”€ æ—¶é—´ä¸­å¿ƒIMUå› å­ (Time-Centric IMU Factors)
â”œâ”€â”€ DVLé€Ÿåº¦å› å­ (DVL Velocity Factors)
â”œâ”€â”€ ç£åŠ›è®¡å› å­ (Magnetometer Factors)
â”œâ”€â”€ GPSä½ç½®å› å­ (GPS Position Factors)
â””â”€â”€ è¿ç»­æ—¶é—´çº¦æŸå› å­ (Continuous-Time Constraint Factors)
```

### æ€§èƒ½æŒ‡æ ‡
- **å®æ—¶æ€§**: < 10ms ä¼˜åŒ–æ±‚è§£æ—¶é—´
- **ç²¾åº¦**: äºšç±³çº§å®šä½ç²¾åº¦ (< 1m)
- **é²æ£’æ€§**: æ”¯æŒä¼ æ„Ÿå™¨æ•…éšœå’Œå¼‚å¸¸å€¼å¤„ç†
- **å¯æ‰©å±•æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ·»åŠ æ–°ä¼ æ„Ÿå™¨

### æ•°æ®å¤„ç†èƒ½åŠ›
- **IMUæ•°æ®**: 100Hzé«˜é¢‘å¤„ç†
- **DVLæ•°æ®**: 10Hzé€Ÿåº¦çº¦æŸ
- **GPSæ•°æ®**: 1Hzä½ç½®æ›´æ–°
- **ç£åŠ›è®¡**: èˆªå‘è§’çº¦æŸ

## ğŸ“ˆ å®éªŒç»“æœ

### æ•°æ®é›†ä¿¡æ¯
- **æ•°æ®æ–‡ä»¶**: `sensor_fusion_log_20250712_102606.csv`
- **æ•°æ®æ—¶é•¿**: çº¦30åˆ†é’Ÿèˆªè¡Œæ•°æ®
- **æ•°æ®é‡**: 34,690è¡Œè®°å½•
- **ä¼ æ„Ÿå™¨**: IMU + DVL + GPS + ç£åŠ›è®¡

### å¯è§†åŒ–ç»“æœ
é¡¹ç›®åŒ…å«å¤šä¸ªå®éªŒç»“æœå¯è§†åŒ–ï¼š
- `gtsam_trajectory_comparison.png`: è½¨è¿¹å¯¹æ¯”å›¾
- `gtsam_position_comparison.png`: ä½ç½®ç²¾åº¦å¯¹æ¯”
- `gtsam_error_comparison.png`: è¯¯å·®åˆ†æ
- `gtsam_rmse_comparison.png`: RMSEå¯¹æ¯”

### LSTMè®­ç»ƒç»“æœ
- **è®­ç»ƒæ•°æ®**: ä»ç¬¬34588è¡Œå¼€å§‹çš„GPSæœ‰æ•ˆæ•°æ®
- **æ¨¡å‹æ¶æ„**: 3å±‚LSTM [128, 64, 32]
- **é¢„æµ‹ç²¾åº¦**: ä½ç½®é¢„æµ‹RMSE < 2m
- **è®­ç»ƒæ—¶é—´**: çº¦30åˆ†é’Ÿï¼ˆGPUåŠ é€Ÿï¼‰

## ğŸ”¬ å®éªŒéªŒè¯

### ä»¿çœŸç¯å¢ƒéªŒè¯
```bash
# å¯åŠ¨ä»¿çœŸç¯å¢ƒ
cd auv_simulation_env
./launch_simulation.sh

# è¿è¡Œç®—æ³•æµ‹è¯•
ros2 run auv_algorithm_test your_algorithm_node
```

### æ€§èƒ½æµ‹è¯•
- **è®¡ç®—æ•ˆç‡**: CPUä½¿ç”¨ç‡ < 50%
- **å†…å­˜å ç”¨**: < 500MB
- **å®æ—¶æ€§**: å¤„ç†å»¶è¿Ÿ < 100ms
- **ç²¾åº¦éªŒè¯**: ä¸Ground Truthå¯¹æ¯”è¯¯å·® < 1m

## ğŸ“š å‚è€ƒæ–‡çŒ®

ä¸»è¦åŸºäºä»¥ä¸‹è®ºæ–‡å®ç°ï¼š
- **Zhang et al. (2024)**: "GNSS/Multi-sensor Fusion Using Continuous-Time Factor Graph Optimization for Robust Localization"
- **ç›¸å…³è®ºæ–‡**: "An Underwater Multisource Fusion Anomaly Detection Navigation Algorithm Based on Factor Graph and LSTM"

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°ä¼ æ„Ÿå™¨
1. åœ¨`underwater_nav_msgs`ä¸­å®šä¹‰æ–°æ¶ˆæ¯ç±»å‹
2. åœ¨`factor_graph_optimizer`ä¸­å®ç°æ–°å› å­
3. åœ¨`data_preprocessing`ä¸­æ·»åŠ æ•°æ®å¤„ç†é€»è¾‘
4. æ›´æ–°é…ç½®æ–‡ä»¶å’Œå¯åŠ¨æ–‡ä»¶

### è°ƒè¯•å·¥å…·
```bash
# æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
ros2 node list

# æ£€æŸ¥è¯é¢˜æ•°æ®
ros2 topic list
ros2 topic hz /imu_data

# æ£€æŸ¥å‚æ•°
ros2 param list /time_centric_navigation_node

# æŸ¥çœ‹æ—¥å¿—
ros2 run factor_graph_optimizer time_centric_navigation_node --ros-args --log-level DEBUG
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **ç¼–è¯‘é”™è¯¯**: æ£€æŸ¥GTSAMå’Œä¾èµ–åº“ç‰ˆæœ¬
2. **èŠ‚ç‚¹å¯åŠ¨å¤±è´¥**: ç¡®è®¤ROS2ç¯å¢ƒæ­£ç¡®é…ç½®
3. **æ•°æ®æ’­æ”¾é—®é¢˜**: æ£€æŸ¥CSVæ–‡ä»¶è·¯å¾„å’Œæ ¼å¼
4. **å¯è§†åŒ–é—®é¢˜**: ç¡®è®¤RVizé…ç½®æ–‡ä»¶è·¯å¾„
5. **LSTMè®­ç»ƒå¤±è´¥**: æ£€æŸ¥Pythonç¯å¢ƒå’Œä¾èµ–åŒ…

### è°ƒè¯•å‘½ä»¤
```bash
# æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
ros2 node list
ros2 topic list
ros2 topic hz /imu_data

# æ£€æŸ¥å‚æ•°
ros2 param list /time_centric_navigation_node

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
ros2 run factor_graph_optimizer time_centric_navigation_node --ros-args --log-level DEBUG
```

## ğŸ‘¥ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›é¡¹ç›®ï¼

### è´¡çŒ®æµç¨‹
1. Forké¡¹ç›®ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤ä»£ç æ›´æ”¹
4. åˆ›å»ºPull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚è¯¦è§LICENSEæ–‡ä»¶ã€‚

## ğŸ“ è”ç³»ä¿¡æ¯

- **å¼€å‘è€…**: dongchenhui
- **é‚®ç®±**: 241314010016@hhu.edu.cn
- **é¡¹ç›®åœ°å€**: `/home/dongchenhui/LSTM_TimeFGO_nav`

---

**æœ€åæ›´æ–°**: 2025-01-27  
**ç‰ˆæœ¬**: v1.0.0
